meta:
  current_goal: "Diagnose and reduce 1-hour multi-agent error spike from live plugin logs"
  run_id: ""
  issue_id: ""
  bundle_path: ""
  current_phase: "implementation-complete"
  current_report: "repairs/progress/20260208114713-poster-save-fallback-fix-plan.md"
  last_log_scan: "/Users/jbmiles/Library/Logs/Plex Media Server/{Plex Media Scanner*,Plex Media Server.log,PMS Plugin Logs/com.plexapp.agents.*.log}"
  last_decision: "Poster save failures are due to Core.storage temp `._` behavior on the media volume and should use a resilient fallback writer"
  last_action: "Patched all active utils copies with SafeSaveFile fallback and corrected empty poster/art metadata key assignment in bundle loops"
  last_code_change: "none"
  last_updated: "2026-02-08"
  next_steps: "Implement null-media guards across highest-volume agents and stabilize GayRado candidate parsing, then rerun 1-hour aggregation to measure reduction"
  stop_condition: "user confirms error counts are reduced or switches tasks"
  notes: "Confirmed: scan activity is fast; perceived slowness is dominated by post-scan deep analysis plus broad agent search loops (notably GayWorld). Controlled A/B completed: single-path refresh was ~1s in both modes with no deep-analysis spawned."

checklist:
  - item: "Collect logs (7-day window)"
    status: "done"
  - item: "Create project-level error catalog"
    status: "done"
  - item: "Create bundle error reports (AEBN, GEVI, GAF, NFO)"
    status: "done"
  - item: "Investigate GayAdultFilms model corruption"
    status: "done â€” self-healing, no code fix needed"
  - item: "Deploy AEBN title match fix"
    status: "done"
  - item: "Fix and deploy GEVI date parsing bug"
    status: "done"
  - item: "Propagate title substring fallback to GayHotMovies, GayFetishandBDSM, GayMovie, GayRado"
    status: "done"
  - item: "Fix AEBN studio match (soft warning instead of hard skip)"
    status: "done"
  - item: "Deploy all fixes to Plex plugins directory"
    status: "done"
  - item: "Restart Plex and validate error reduction"
    status: "todo"
  - item: "Run live log aggregation and apply shared parser hardening"
    status: "done"
  - item: "Diagnose scan slowness from raw scanner/server/plugin logs"
    status: "done"
  - item: "Prepare controlled single-item A/B benchmark for deep analysis impact"
    status: "done"
  - item: "Run A/B benchmark and capture timings in report"
    status: "done"

decisions:
  - date: "2026-02-05"
    decision: "Scope: catalog errors for all gay adult agents"
    rationale: "User requested comprehensive error cataloging"
  - date: "2026-02-05"
    decision: "GayAdultFilms model errors are self-healing, deprioritized"
    rationale: "Contributing agents create models on successful write; fixing AEBN/GEVI will cascade"
  - date: "2026-02-05"
    decision: "Fix GEVI date parsing bug (item vs items variable)"
    rationale: "All 3 date range branches used wrong variable and wrong slice lengths"
  - date: "2026-02-05"
    decision: "Make AEBN studio mismatch a soft warning (score=86) instead of hard skip"
    rationale: "221 errors from production vs distribution studio name mismatches; title+date+duration still valid"
  - date: "2026-02-08"
    decision: "Use raw scanner/server/plugin logs rather than consolidated templates for performance diagnosis"
    rationale: "Need true wall-clock timelines and job sequencing, not grouped error patterns"
  - date: "2026-02-08"
    decision: "Benchmark before changing settings or code"
    rationale: "Need measured before/after evidence to separate deep analysis cost from scraper search cost"
  - date: "2026-02-08"
    decision: "Use section refresh with exact file path for controlled test because metadata-level refresh endpoint is unavailable on this PMS build"
    rationale: "`/library/metadata/471/refresh` returned 404 while `/library/sections/1/refresh?path=...` returned 200"
  - date: "2026-02-08"
    decision: "Use DELETE /butler as stop-all maintenance control on this PMS build"
    rationale: "DELETE /butler returns 200 and effectively halts queued Butler work"
  - date: "2026-02-08"
    decision: "Treat resourceHashes startup 404 as low-priority framework noise and prioritize fix for update crash when metadata tree fetch returns 404"
    rationale: "Tracebacks show actionable user impact occurs when media object is None and update() dereferences media.title"
  - date: "2026-02-08"
    decision: "Prioritize cross-agent null-guard hardening and GayRado parser stabilization before broader scraper refactors"
    rationale: "One-hour aggregation shows these are the highest-volume actionable contributors to spike behavior"

reports:
  - name: "scan-performance-investigation.md"
    path: "repairs/progress/20260208035154-scan-performance-investigation.md"
    status: "done"
  - name: "deep-analysis-ab-benchmark.md"
    path: "repairs/progress/20260208042313-deep-analysis-ab-benchmark.md"
    status: "done"
  - name: "gayadultfilms-criticals-triage.md"
    path: "repairs/progress/20260208112523-gayadultfilms-criticals-triage.md"
    status: "done"
  - name: "hourly-error-spike-diagnostic.md"
    path: "repairs/progress/20260208113312-hourly-error-spike-diagnostic.md"
    status: "done"
  - name: "refresh-trigger-vs-root-cause.md"
    path: "repairs/progress/20260208113544-refresh-trigger-vs-root-cause.md"
    status: "done"
  - name: "resourcehash-live-status-and-fix-options.md"
    path: "repairs/progress/20260208113838-resourcehash-live-status-and-fix-options.md"
    status: "done"
  - name: "poster-save-fallback-fix-plan.md"
    path: "repairs/progress/20260208114713-poster-save-fallback-fix-plan.md"
    status: "done"
  - name: "error-catalog.md"
    path: "repairs/information/error-catalog.md"
    status: "done"
  - name: "AEBN error catalog"
    path: "AEBN.bundle/Contents/repairs/202602051531-error-catalog.md"
    status: "done"
  - name: "GEVI error catalog"
    path: "GEVI.bundle/Contents/repairs/202602051531-error-catalog.md"
    status: "done"
  - name: "GayAdultFilms error catalog"
    path: "GayAdultFilms.bundle/Contents/repairs/202602051531-error-catalog.md"
    status: "done"
  - name: "NFOImporter error catalog"
    path: "NFOImporter.bundle/Contents/repairs/202602051531-error-catalog.md"
    status: "done"

blockers:
  - "Plex plugin restart needed for all new fixes to take effect"
  - "None for benchmark execution; follow-up performance tuning choices remain"

handoff:
  summary: "A/B benchmark completed. Single-file targeted refresh for item 471 ran in ~1s with deep-analysis setting both off and on, and no deep-analysis jobs spawned during either pass. This reinforces that direct refresh/scan is fast and perceived slowness is from queued maintenance deep analysis and broad agent search spans."
  next_actions:
    - "Decide policy for `ButlerTaskDeepMediaAnalysis` (leave enabled but restrict maintenance window, or disable by default during active use)."
    - "Optionally run a wider A/B over a small folder batch (10-20 items) to quantify queued maintenance effect under normal evening usage."
    - "Continue scraper optimization focus (GayWorld query breadth/timeouts) to reduce non-scan wall-clock delays."
  resume_context:
    - "A/B report: `repairs/progress/20260208042313-deep-analysis-ab-benchmark.md`."
    - "Target item metadata path used for test: `/Volumes/internal/porn_movies/(Blue Pictures) - 5 Bros on Whitey Boy (2006).avi`."
    - "On this PMS build, stop maintenance queue with `DELETE /butler` (HTTP 200)."
    - "Deep worker cleanup command validated: `pkill -f \"Plex Media Scanner.*--analyze-deeply\"`."
